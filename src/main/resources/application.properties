spring.application.name=gg-stats

spring.datasource.url=jdbc:postgresql://localhost:5432/dota_stats
spring.datasource.username=myuser
spring.datasource.password=secret

spring.sql.init.mode=always
spring.batch.jdbc.initialize-schema=never

# Default user for development
spring.security.user.name=admin
spring.security.user.password=admin

opendota.api.base-url=https://api.opendota.com/api

spring.threads.virtual.enabled=true

# Logging configuration - balanced level
logging.level.root=INFO
logging.level.com.abe.gg_stats=DEBUG
logging.level.org.springframework.batch=INFO
logging.level.org.springframework.jdbc=WARN
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN

# Log to current project dir
logging.file.name=./gg-stats.log

# Structured logging configuration
# Note: Patterns are overridden by logback-spring.xml for better control
logging.pattern.console=%d{HH:mm:ss.SSS} [%thread] %-5level [%X{correlationId:-}] [%X{operationType:-}] [%X{serviceName:-}] %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level [%X{correlationId:-}] [%X{jobId:-}] [%X{stepName:-}] [%X{batchType:-}] [%X{apiEndpoint:-}] %logger{36} - %msg%n

# JSON logging configuration (enabled via spring profiles)
app.logging.structured.enabled=true
app.logging.json.enabled=${app.logging.structured.enabled:false}

# OpenDota API Rate Limiting - Matches OpenDota's actual limits
opendota.api.rate-limit.per-minute=60
opendota.api.rate-limit.per-day=2000
opendota.api.rate-limit.burst-capacity=60
opendota.api.refill-interval.milliseconds=60000
opendota.api.rate-limit.enable-waiting=true

# OpenDota API Timeouts and Circuit Breaker - Faster response to rate limiting
circuit-breaker.failure-threshold=20
circuit-breaker.success-threshold=3
circuit-breaker.timeout-duration-ms=30000
circuit-breaker.minimum-calls=5
circuit-breaker.sliding-window-size=100

# Batch Processing Configuration
app.batch.heroes.chunk-size=60
app.batch.heroes.retry-limit=3
app.batch.heroes.skip-limit=10

# Player Batch Configuration - Chunked Processing
app.batch.players.chunk-size=60
app.batch.players.retry-limit=3
app.batch.players.skip-limit=10
app.batch.players.max-memory-usage=100
app.batch.players.api-delay-ms=1000

app.batch.teams.chunk-size=10
app.batch.teams.retry-limit=3
app.batch.teams.skip-limit=10

app.batch.notable-players.chunk-size=10
app.batch.notable-players.retry-limit=3
app.batch.notable-players.skip-limit=10

app.batch.hero-rankings.chunk-size=10
app.batch.hero-rankings.retry-limit=3
app.batch.hero-rankings.skip-limit=10

app.batch.expiration.heroes=1h
app.batch.expiration.teams=1h
app.batch.expiration.notableplayers=1h
app.batch.expiration.herorankings=1h
app.batch.expiration.players=1h
app.batch.expiration.default=1h

# Startup Jobs Configuration

spring.batch.job.enabled=false
spring.jpa.properties.hibernate.connection.isolation=2  # READ_COMMITTED
